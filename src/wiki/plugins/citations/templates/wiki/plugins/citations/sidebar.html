{% load i18n sekizai_tags static %}

<h4>{% trans "Add citation" %}</h4>

<p>
  {% trans "Select in the location where the information added can be found. Keep your contribution between the >> and
  the [*]:" %}<br />
</p>

<pre> &gt&gt TEXT [*](wiki:/BaseWiki/chapters/Chapter#)</pre>

<p>
  {% trans "Note that citations are required for all test in the wiki for allow for filtering based on spoilers"
  %}<br />
</p>

<p>
  {% trans "If addition is spoiler-free meta series information, such as author information, remove * and refer to base
  wiki:" %}<br />
</p>

<pre> &gt&gt Meta Information [](wiki:/BaseWiki/MediaType)</pre>


<div class="input-group">
  <select id="citations_page_title_query"></select>

  <div class="input-group-append">
    <button class="btn btn-outline-secondary" type="button" id="citation_add_citation_button">Add Citation</button>
  </div>
</div>

<hr />


{% addtoblock "js" %}
<script type="text/javascript" src="{% static 'wiki/select2/js/select2.min.js' %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}
<script type="text/javascript">
  $(document).ready(function () {
    $('#citations_page_title_query').select2({
      dropdownAutoWidth: true,
      placeholder: "Type to search...",
      ajax: {
        url: function (params) {
          return "{% url 'wiki:citations_query_urlpath' path=urlpath.path article_id=article.id %}?query=" + params.term
        },
        processResults: function (data) {
          let ret = [];
          data.forEach(function (val) {
            ret.push({ "id": val, "text": val })
          });
          return { results: ret };
        },
      },
    });
    // Store the value to be displayed
    let addedValue = "";

    // Update the value to add to the page on click of citation_add_citation_button
    $('#citations_page_title_query').on('select2:select', function (e) {
      addedValue = ">> ADD YOUR CONTRIBUTION HERE [*](wiki:" + e.params.data.id.split("wiki:")[1] + ")";
    });

    $("#citation_add_citation_button").on("click", function () {
      $('#id_content').insertAtCaret(addedValue);
    });
  });

</script>
{% endaddtoblock %}
{% addtoblock "css" %}
<link rel="stylesheet" href="{% static 'wiki/select2/css/select2.min.css' %}" type="text/css" />
{% endaddtoblock %}