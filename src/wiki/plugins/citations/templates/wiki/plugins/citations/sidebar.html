{% load i18n sekizai_tags static %}

<h4>{% trans "Add citation to text in wiki" %}</h4>

<p>
  {% trans "Type in the chapter number or name and the wiki page to the tag will pop up. Keep your text between the >> and the [*]:" %}<br />
</p>

<pre> &gt&gt Text [*](wiki:/BaseWiki/chapters/Chapter#)</pre>
<div class="input-group">
  <select id="links_page_title_query"></select>

  <div class="input-group-append">
    <button class="btn btn-outline-secondary" type="button" id="citation_insert_button">Insert</button>
  </div>
</div>

<hr />


{% addtoblock "js" %}<script type="text/javascript" src="{% static "wiki/select2/js/select2.min.js" %}"></script>{% endaddtoblock %}
{% addtoblock "js" %}
<script
type = "text/javascript" >
  $(document).ready(function () {
    $('#links_page_title_query').select2({
      dropdownAutoWidth: true,
      placeholder: "Type to search...",
      ajax: {
        url: function (params) {
          return "{% url 'wiki:links_query_urlpath' path=urlpath.path article_id=article.id %}?query=" + params.term
        },
        processResults: function (data) {
          let ret = [];
          data.forEach(function (val) {
            ret.push({"id": val, "text": val})
          });
          return {results: ret};
        },
      },
    });

    $("#link_insert_button").on("click", function () {
      $('#id_content').insertAtCaret($('#links_page_title_query').val());
    });
  });

</script>
{% endaddtoblock %}
{% addtoblock "css" %}
<link rel="stylesheet" href="{% static "wiki/select2/css/select2.min.css" %}" type="text/css" />
{% endaddtoblock %}
